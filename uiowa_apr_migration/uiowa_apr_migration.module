<?php

/**
 * You must implement hook_migrate_api(), setting the API level to 2, for
 * your migration classes to be recognized by the Migrate module.
 */
function uiowa_apr_migration_migrate_api() {
  $api = array(
    'api' => 2,
    'groups' => array(
      'apr_people' => array(
        'title' => t('APR People'),
      ),
    ),
    'migrations' => array(
      'APRPeople' => array(
        'class_name' => 'APRPeopleNodeMigration',
        'group_name' => 'apr_people',
      ),
      'APRPeopleAppointments' => array(
        'class_name' => 'APRPeopleAppointmentFieldCollectionMigration',
        'group_name' => 'apr_people',
      ),
    ),
  );
  return $api;
}

/**
* Implementation of hook_cron. Runs APR migrations.
*/
function uiowa_apr_migration_cron() {
  // Get API Key and Population ID location
  $api_key = variable_get('uiowa_apr_api_key', '');
  $population = variable_get('uiowa_apr_population_id', '');

  // Get migration objects
  $people = Migration::getInstance('APRPeople');
  $appointments = Migration::getInstance('APRPeopleAppointments');

  // Check if API key and population ID are set
  if(!empty($api_key) && !empty($population)){
    $result = $people->processImport();
    $result = $appointments->processImport();
  }
}
